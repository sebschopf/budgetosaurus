{# webapp/templates/webapp/index.html #}
{% extends 'webapp/base.html' %}

{% block title %}Tableau de Bord{% endblock %}

{% block extra_head %}
    {# Styles spécifiques à cette page si nécessaire #}
    <style>
        /* Grille pour les cartes de solde des comptes */
        .balance-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        /* Style des cartes de solde */
        .card {
            background-color: #ecf0f1; /* gray-200 */
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .card h3 { margin-top: 0; color: #34495e; } /* gray-800 */
        .card p { font-size: 1.8em; font-weight: bold; margin: 0; }
        /* Couleurs pour les soldes */
        .positive { color: #27ae60; } /* Vert pour positif */
        .negative { color: #e74c3c; } /* Rouge pour négatif */
        .neutral { color: #3498db; }  /* Bleu pour neutre */

        /* Styles des tableaux (déjà dans base.html, conservé pour surcharge si nécessaire) */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:hover { background-color: #f9f9f9; }
        /* Couleurs pour les montants de transaction */
        .transaction-amount.income { color: #27ae60; }
        .transaction-amount.expense { color: #e74c3c; }
        .no-transactions { text-align: center; color: #7f8c8d; padding: 20px; }
        
        /* Section du formulaire */
        .form-section {
            background-color: #f9f9f9; /* gray-50 */
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        /* Styles spécifiques pour les boutons de date (déjà dans base.html) */

        /* Styles pour les actions de suppression par lot */
        .batch-actions {
            display: flex;
            justify-content: flex-end; /* Aligner à droite */
            margin-top: 15px;
            margin-bottom: 10px;
        }
        .batch-actions button {
            background-color: #e74c3c; /* Rouge pour supprimer */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
        }
        .batch-actions button:hover {
            background-color: #c0392b;
        }

        /* NOUVEAUX STYLES POUR LES PICTOGRAMMES / BADGES DE CATÉGORIE */
        .category-info-icon {
            font-size: 0.8em;
            margin-left: 5px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            display: inline-block;
            vertical-align: middle;
            line-height: 1; /* Aligner le texte */
        }
        .category-info-icon.fund-managed {
            background-color: #28a745; /* Vert pour les fonds */
        }
        .category-info-icon.budgeted {
            background-color: #007bff; /* Bleu pour les budgets */
        }
        .category-info-icon.no-special {
            background-color: #6c757d; /* Gris pour les autres */
        }
        /* Masquer initialement les icônes dans les options du select (géré par JS) */
        .form-field-group select option .category-info-icon {
            display: none;
        }
    </style>
{% endblock %}

{% block content %}
    <h1 class="text-center text-3xl font-bold text-gray-800 mb-6">Tableau de Bord de Votre Budget</h1>

    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Soldes par Compte</h2>
    <div class="balance-cards-grid">
        {% for name, data in account_balances.items %}
            <div class="card">
                <h3>{{ name }}</h3>
                <p class="{% if data.balance >= 0 %}positive{% else %}negative{% endif %}">{{ data.balance|floatformat:2 }} {{ data.currency }}</p>
            </div>
        {% endfor %}
    </div>

    {# Inclure le formulaire d'ajout de transaction #}
    {% include 'webapp/dashboard_includes/transaction_form.html' %}

    {# Inclure le tableau des dernières transactions #}
    {% include 'webapp/dashboard_includes/latest_transactions_table.html' %}
{% endblock %}

{% block extra_js %}
    {# Définir les données des catégories et sous-catégories en JSON à l'aide de json_script #}
    <script id="allCategoriesData" type="application/json">
        {{ all_categories_data_json|safe }}
    </script>
    <script id="allSubcategoriesData" type="application/json">
        {{ all_subcategories_data_json|safe }}
    </script>
    {# Inclure les scripts spécifiques au tableau de bord #}
    {% include 'webapp/dashboard_includes/dashboard_scripts.html' %}
{% endblock %}
